{
  "hash": "13be3976ac1791e25c2189817a61b5a4",
  "result": {
    "engine": "knitr",
    "markdown": "--- \noutput: html_document \neditor_options:  \n  chunk_output_type: console\n--- \n\n\n\n \n\n# Dealing with Messy Data II: Model Assumptions\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## Goals of Unit\n\n- Understand 5 assumptions of GLMs.\n\n- Understand consequences of assumption violations.\n  - Inefficient standard errors (low power, type II errors).\n  - Inaccurate standard errors (incorrect statistical tests, type I errors).\n  - Inaccurate parameter estimates.\n  \n- Learn how to detect violations (statistical tests and visual diagnosis).\n\n- Recognize the range of options available when violations are detected. Implementation of these options will be covered over the semester.\n\n- Examination of assumptions will further inform you about your data.\n\n-----\n\n## Assessment of Assumptions for Sig. Tests\n\nAll GLM procedures commonly make the **5 assumptions below**. When these assumptions are met, OLS regression coefficients are MVUE (Minimum Variance Unbiased Estimators) and BLUE (Best Linear Unbiased Estimators). With the exception of $\\#1$, these assumptions are expressed (and assessed) with respect to the residuals around the prediction line.\n\n1. **Exact X:** The IVs are assumed to be known exactly (i.e., without measurement error).\n2. **Independence:**  Residuals are independently distributed (prob. of obtaining a specific observation does not depend on other observations).\n3. **Normality:**  All residual distributions are normally distributed.\n4. **Constant variance:**  All residual distributions have a constant variance, $\\text{SEE}^2$.\n5. **Linearity:**  All residual distributions (i.e., for each $Y'$) are assumed to have means equal to zero.\n\n-----\n\n## Exact X\n\nViolations of the Exact X assumption lead to biased (i.e., inaccurate) estimates of regression coefficients.  \n\nViolations are caused by problems with reliability of measurement of your predictors.\n\n<span style=\"color: red;\">Question: In simple, bivariate regression, how will reducing reliability affect the regression model?</span> \n\n-----\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_model_assumptions_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n<span style=\"color: blue;\">It will reduce $b_1$. We will underestimate the strength of relationship between $X$ and $Y$.</span>   \n\n<span style=\"color: blue;\">In multiple predictor models, the bias can be either positive or negative based on the nature of the correlations among the predictors. **Use reliable variables!**.</span>\n\n<span style=\"color: red;\">Question: What are the implications of unreliable $X$ for the use of covariates to *control* variables?</span> \n\n-----\n\n<span style=\"color: blue;\">Covariates only *control* from the construct they measure to the degree that they are reliable (and valid) measures of that construct.</span>\n\n<span style=\"color: blue;\">Analysis that rely on unreliable covariates are not controlling the variance for the construct well.</span>\n\n-----\n\n## Independence\n\nViolations of the independence of residuals assumption can compromise the validity of our statistical tests (inaccurate standard errors).   \n\nViolations of residuals independence is a function of the research design caused by repeated measures on the same individual or related individuals/observations (participants in same family, school, etc).  \n\nOften difficult to detect in data but clear from research design.\n\nCan be fixed by a variety of approaches including repeated measures analyses (**later this semester**) or multi-level, mixed effects, and/or hierarchical linear models (**next semester**).\n\n-----\n\n## Assessment of Residuals: General Issues\n\nRemaining three assumptions (Normality distributed residuals with a mean of 0 and constant variance) can be assessed via examination of the residuals. \n\nUse of Graphical Methods is emphasized.\n\nStatistical tests of assumptions exist but should be used cautiously.\n\nAssessment of assumptions about residuals is an inexact science: Conclusions are tentative.\n\nThe process of examining residuals will increase your understanding of your data.\n\t- May suggest transformations of your data.\n\t- May suggest alternative analytic strategies.\n\t- Will increase your confidence in your conclusions.\n\n-----\n\n## Residuals by $\\hat{Y}$: Normal M = 0, S = Constant\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add plots\n```\n:::\n\n\n\n\n\n\n-----\n\n## Normally Distributed Errors\n\nThe errors for each $\\hat{Y}$ are assumed to be normally distributed. Normally distributed errors are required for OLS regression coefficients to be MVUE but not BLUE.   \n\nCentral limit theory indicates that even with non-normal errors, **significance tests and confidence intervals are approximately correct with large $N$.**\n\nCoefficients are still best unbiased efficient estimators among linear solutions (i.e., BLUE) but **more efficient non-linear solutions** may exist (e.g., Generalized Linear Models such as Poisson regression for thick tailed distributions). \n\n**Mean may not be best measure of center** of a highly skewed distribution.\n\nMultimodal error distributions suggest the **omission of one or more categorical variables** that divide the data into groups.\n\nTransformations may correct shape of residuals (*Unit 9*).\n\n\n-----\n\n## Normality: Quantile Comparison & Density Plots\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(car) # needed for model_assumptions\nlibrary(psych) # needed for model_assumptions\nlibrary(gvlma) # needed for model_assumptions\n\ntheme_set(theme_classic()) \n\ndata <- read_csv(here::here(\"data_lecture/7_three_predictors_fps.csv\"), \n                 show_col_types = FALSE) |> \n   mutate(sex_c = if_else(sex == \"female\", -.5, .5))\n```\n:::\n\n\n\n\nWe have a second function written by John called `model_assumptions()` that you can source to help test model assumptions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/model_assumptions.R?raw=true\")\n```\n:::\n\n\n\n\nLets refit our last model from the previous section.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_rm_outliers <- data |> \n  filter(!subid %in% c(\"0125\", \"2112\"))\n\nm_2 <- lm(fps ~ bac + ta + sex_c, data = data_rm_outliers) \n```\n:::\n\n\n\n\n-----\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_assumptions(m_2, Type = \"normal\", one.page = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDescriptive Statistics for Studentized Residuals\n\nCall:\nlm(formula = fps ~ bac + ta + sex_c, data = data_rm_outliers)\n\nCoefficients:\n(Intercept)          bac           ta        sex_c  \n    26.5528    -228.8721       0.1256     -15.4874  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = Model) \n\n                    Value  p-value                   Decision\nGlobal Stat        9.8263 0.043458 Assumptions NOT satisfied!\nSkewness           0.2921 0.588886    Assumptions acceptable.\nKurtosis           1.0393 0.307987    Assumptions acceptable.\nLink Function      0.1898 0.663091    Assumptions acceptable.\nHeteroscedasticity 8.3051 0.003953 Assumptions NOT satisfied!\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#  2 plots not showing up (dont need gvlma output)\n```\n:::\n\n\n\n\n-----\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# q-q plots\n# density plot\n```\n:::\n\n\n\n\n\n-----\n\n## Constant Variance\n\nThe errors for each $\\hat{Y}$ are assumed have a constant variance (homoscedasticity). This is necessary for the OLS estimated coefficients to be BLUE.\n\nIf the errors are heteroscedastic, the **coefficients remain unbiased** but the **efficiency (precision of estimation) is impaired** and the **coefficient SEs become inaccurate**. The degree of the problem depends on severity of violation and sample size.\n\nRough rule is that estimation is seriously degraded if the ratio of largest to smallest variance is 10 or greater (or more conservatively, 4 or greater)\n\n1.  Transformations may fix this issue (*next unit*).\n\n2.  Weighted Least Squares provides an alternative to estimation when heteroscedasticity exists (maybe next semester?).\n\n3.  Corrections also exist for SEs when errors are heteroscedastic (more on this in a moment).\n\n-----\n\n## Constant Variance: Residual and Spread-Level Plots\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_assumptions(m_2, Type = \"constant\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nSuggested power transformation:  0.2555876 \n\n\nNon-constant Variance Score Test \nVariance formula: ~ fitted.values \nChisquare = 21.89294, Df = 1, p = 0.0000028829\n\nCall:\nlm(formula = fps ~ bac + ta + sex_c, data = data_rm_outliers)\n\nCoefficients:\n(Intercept)          bac           ta        sex_c  \n    26.5528    -228.8721       0.1256     -15.4874  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = Model) \n\n                    Value  p-value                   Decision\nGlobal Stat        9.8263 0.043458 Assumptions NOT satisfied!\nSkewness           0.2921 0.588886    Assumptions acceptable.\nKurtosis           1.0393 0.307987    Assumptions acceptable.\nLink Function      0.1898 0.663091    Assumptions acceptable.\nHeteroscedasticity 8.3051 0.003953 Assumptions NOT satisfied!\n```\n\n\n:::\n\n```{.r .cell-code}\n# 2 plots should show up side by side - dont need gvlma output\n```\n:::\n\n\n\n\nA spread level plot is a plot of the log(abs(studentized residuals) vs. log(fitted values). $1-b$ (from the regression line to the right) is the suggested power transformation for $Y$ to stabilize variance.  \n\nSuggested power transformation:  0.2699878 \n\n-----\n\n## Constant Variance: Statistical Test\n\nBreusch & Pagan (1979)^[Breusch,T. S. and Pagan,A. R. (1979) A simple test for heteroscedasticity and random coefficient variation. *Econometrica*, 47,  1287-1294.] and Cook & Weisberg (1983)^[Cook,R. D. and Weisberg,S. (1983) Diagnostics for heteroscedasticity in regression. *Biometrika*, 70, 1-10.] independently developed test for constant variance.\n\n`ncvTest()` in `car` package. Also provided by `model_assumptions()` as well.  \n\nDo not use it blindly. All statistical tests are designed to be sensitive to specific types of violations. May miss other types of violations.May also provide false positive due to other aspects of the distribution.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncar::ncvTest(m_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNon-constant Variance Score Test \nVariance formula: ~ fitted.values \nChisquare = 21.89294, Df = 1, p = 0.0000028829\n```\n\n\n:::\n:::\n\n\n\n\n-----\n\n## Constant Variance: Correcting SEs\n\nStandard errors are inaccurate when variance of residuals is not constant. A procedure to provide White (1980)^[Long,J.S. and Ervin,L.H. (2000) Using heteroscedasity consistent standard errors in the linear regression model. *The American Statistician* 54, 217–224.;cWhite,H. (1980) A heterskedastic consistent covariance matrix estimator and a direct test of heteroskedasticity.\n*Econometrica* 48, 817–838.] corrected SEs is described in Fox (2008), chapter 12, pp 275-276. \n\n\nUncorrected Tests of Coefficients\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::tidy(m_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 5\n  term        estimate std.error statistic   p.value\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)   26.6      6.44        4.13 0.0000825\n2 bac         -229.      72.4        -3.16 0.00214  \n3 ta             0.126    0.0273      4.61 0.0000135\n4 sex_c        -15.5      5.70       -2.72 0.00790  \n```\n\n\n:::\n:::\n\n\n\n\nWhite (1980) Heteroscedasticity-corrected SEs and Tests\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrected_ses <- sqrt(diag(hccm(m_2)))\n\nbroom::tidy(m_2) |> \n  select(term, estimate) |> \n  add_column(std.error = corrected_ses) |> \n  mutate(statistic = estimate/std.error,\n         p.value = 2*(pt(abs(statistic), df=m_2$df.residual, lower.tail=FALSE)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 5\n  term        estimate std.error statistic   p.value\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)   26.6      6.90        3.85 0.000220 \n2 bac         -229.      72.1        -3.18 0.00204  \n3 ta             0.126    0.0304      4.13 0.0000799\n4 sex_c        -15.5      5.70       -2.72 0.00791  \n```\n\n\n:::\n:::\n\n\n\n\n\n-----\n\n## Linearity: Component + Residuals Plots\n\nIf Linearity assumption is not met, coefficients are biased.  \n\nPlot partial residual ($e_{i(j)} = e_i + b_jX_{ij}$) by each predictor.  \n\nCan include factors but can not include interactions with factors. Code regressors manually. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_assumptions(m_2, Type='linear')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = fps ~ bac + ta + sex_c, data = data_rm_outliers)\n\nCoefficients:\n(Intercept)          bac           ta        sex_c  \n    26.5528    -228.8721       0.1256     -15.4874  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = Model) \n\n                    Value  p-value                   Decision\nGlobal Stat        9.8263 0.043458 Assumptions NOT satisfied!\nSkewness           0.2921 0.588886    Assumptions acceptable.\nKurtosis           1.0393 0.307987    Assumptions acceptable.\nLink Function      0.1898 0.663091    Assumptions acceptable.\nHeteroscedasticity 8.3051 0.003953 Assumptions NOT satisfied!\n```\n\n\n:::\n\n```{.r .cell-code}\n# 3 plots not showing up\n```\n:::\n\n\n\n\n\n\n-----\n\n\n## Global Test of Model Assumptions\n\nPena and Slate (2006) validated a global test of linear model assumptions.^[Pena,E.A. and Slate,E.H. (2006). Global validation of linear model assumptions, *Journal of the American Statistical Association*, 101, 341-354.]\n\nProvided by `model_assumptions()` using `gvlma` package\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngvlma(m_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = fps ~ bac + ta + sex_c, data = data_rm_outliers)\n\nCoefficients:\n(Intercept)          bac           ta        sex_c  \n    26.5528    -228.8721       0.1256     -15.4874  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = m_2) \n\n                    Value  p-value                   Decision\nGlobal Stat        9.8263 0.043458 Assumptions NOT satisfied!\nSkewness           0.2921 0.588886    Assumptions acceptable.\nKurtosis           1.0393 0.307987    Assumptions acceptable.\nLink Function      0.1898 0.663091    Assumptions acceptable.\nHeteroscedasticity 8.3051 0.003953 Assumptions NOT satisfied!\n```\n\n\n:::\n:::\n\n\n\n\n\n-----\n\n## Transformations: The Family of Powers & Roots\n\n- Power transformations (*next unit*) are very useful for correcting problems with normality, constant, variance, and linearity of errors.\n\n- Polynomial regression (*PSY 710*) is useful when you have quadratic, cubic, etc. effects of $X$s on $Y$.\n\n- Generalized linear models (e.g., Logistic regression; *PSY 710*) are also available.\n\n\n-----\n\n\n\n-----\n\n## Summary of Violation Consequences and Solutions\n\n1. **Exact X**  \n\n    - Inaccurate (biased) parameter estimates.\n    - Use reliable measures of $X$s, use SEM with latent variables.\n\n2. **Independence**\n\n    - Inaccurate standard errors.\n    - Use repeated measures, use multi-level models.\n\n3. **Normally distributed errors**\n\n    - Inefficient standard errors.\n    - Consider omitted variables, use transformations, use generalized linear models.\n\n4. **Constant variance for errors**\n\n    - Inaccurate and inefficient standard errors.\n    - Use SE corrections (but still inefficient), use transformations, use weighted least squares.\n      \n5. **Linearity** (Error distributions all have mean of 0)    \n\n    - Inaccurate (biased) parameter estimates.\n    - Use transformations, use polynomial regression, use generalized linear models.\n\n",
    "supporting": [
      "08_model_assumptions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}